{
  "title": "Tyk Gateway - API Performance & Health",
  "uid": "tyk-api-performance-health",
  "version": 1,
  "tags": [
    "tyk",
    "api",
    "performance",
    "health",
    "opentelemetry",
    "observability"
  ],
  "timezone": "browser",
  "editable": true,
  "graphTooltip": 1,
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "refresh": "30s",
  "timepicker": {
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m"
    ],
    "time_options": [
      "5m",
      "15m",
      "1h",
      "3h",
      "6h",
      "12h",
      "24h",
      "7d",
      "30d"
    ]
  },
  "templating": {
    "list": [
      {
        "name": "datasource_prometheus",
        "type": "datasource",
        "query": "prometheus",
        "current": {
          "text": "Prometheus",
          "value": "Prometheus"
        },
        "hide": 0,
        "label": "Prometheus"
      },
      {
        "name": "datasource_jaeger",
        "type": "datasource",
        "query": "jaeger",
        "current": {
          "text": "Jaeger",
          "value": "Jaeger"
        },
        "hide": 0,
        "label": "Jaeger"
      },
      {
        "name": "datasource_opensearch",
        "type": "datasource",
        "query": "grafana-opensearch-datasource",
        "current": {
          "text": "OpenSearch",
          "value": "webstore-logs"
        },
        "hide": 0,
        "label": "OpenSearch",
        "refresh": 1,
        "regex": "",
        "options": [],
        "includeAll": false,
        "multi": false
      },
      {
        "name": "instance",
        "type": "query",
        "label": "Gateway Instance",
        "datasource": "${datasource_prometheus}",
        "query": "label_values(up{job=\"tyk-gateway\"}, instance)",
        "multi": true,
        "includeAll": true,
        "allValue": ".*",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "refresh": 1,
        "sort": 1,
        "todo": "Gateway tags is not included in gateway metrics by default. You need to add 'tag' to the 'labels' section in Tyk Gateway Prometheus metrics configuration to use this variable."
      },
      {
        "name": "api_id",
        "type": "query",
        "label": "API ID",
        "datasource": "${datasource_prometheus}",
        "query": "label_values(tyk_http_status_total{instance=~\"$instance\"}, api)",
        "multi": true,
        "includeAll": true,
        "allValue": ".*",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "refresh": 1,
        "sort": 1,
        "todo": "Since metrics comes from tyk pump, APIs are not filtered by gateway instance now. Can we support filtering by API category or other metadata?"
      },
      {
        "name": "portal_org",
        "type": "query",
        "label": "Portal Organization",
        "datasource": "${datasource_prometheus}",
        "query": "label_values(tyk_http_status_per_org_and_app_total{instance=~\"$instance\", api=~\"$api_id\"}, portal_org)",
        "multi": true,
        "includeAll": true,
        "allValue": ".*",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "refresh": 1,
        "sort": 1
      },
      {
        "name": "portal_app",
        "type": "query",
        "label": "Portal App",
        "datasource": "${datasource_prometheus}",
        "query": "label_values(tyk_http_status_per_org_and_app_total{instance=~\"$instance\", api=~\"$api_id\", portal_org=~\"$portal_org\"}, portal_app)",
        "multi": true,
        "includeAll": true,
        "allValue": ".*",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "refresh": 1,
        "sort": 1
      }
    ]
  },
  "annotations": {
    "list": [
      {
        "name": "Gateway Deployments",
        "datasource": "${datasource_opensearch}",
        "enable": true,
        "iconColor": "green",
        "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"main\" AND body:\"Tyk Gateway started\"",
        "textField": "",
        "titleField": "body"
      },
      {
        "name": "API Deployments",
        "datasource": "${datasource_opensearch}",
        "enable": true,
        "iconColor": "blue",
        "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"gateway\" AND body:*API Loaded*",
        "textField": "body",
        "titleField": "attributes.tyk.api_id"
      }
    ]
  },
  "links": [
    {
      "title": "Jaeger UI",
      "url": "http://localhost:8085/jaeger/ui",
      "icon": "external link",
      "type": "link",
      "targetBlank": true
    },
    {
      "title": "Prometheus",
      "url": "http://localhost:9090",
      "icon": "external link",
      "type": "link",
      "targetBlank": true
    },
    {
      "title": "API Detail View",
      "url": "/d/tyk-api-detail?var-api_id=${api_id}&${__url_time_range}",
      "icon": "dashboard",
      "type": "link",
      "targetBlank": false,
      "tooltip": "View detailed metrics for a specific API"
    }
  ],
  "panels": [
    {
      "id": 199,
      "type": "row",
      "title": "\ud83d\udd0d API Troubleshooting Guide (Click to expand)",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "collapsed": true,
      "panels": [
        {
          "id": 200,
          "type": "text",
          "title": "API Troubleshooting Guide",
          "gridPos": {
            "h": 10,
            "w": 24,
            "x": 0,
            "y": 1
          },
          "options": {
            "mode": "markdown",
            "content": "# \ud83d\udd0d API Troubleshooting Guide\n\n## 1\ufe0f\u20e3 Start Here: Check System Health\n- **\ud83d\udfe2 Green (Healthy):** All systems operating normally - no action needed\n- **\ud83d\udfe1 Yellow (Degraded):** Some issues detected - review active alerts below \u2b07\ufe0f\n- **\ud83d\udd34 Red (Critical):** Immediate attention required - follow alert guidance immediately\n\n---\n\n## 2\ufe0f\u20e3 Common Issue Patterns - Quick Diagnosis\n\n### \ud83d\udd34 High Error Rate?\n**Steps:** Check Error Traces \u2192 Identify status codes \u2192 See upstream health \u2192 [View API Detail](/d/tyk-api-detail?var-api_id=${api_id})  \n**Panels:** [Error Rate](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=2) | [Error Traces](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=23) | [Upstream Health](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=30)\n\n### \ud83d\udc0c Slow Performance?\n**Steps:** Check Latency Breakdown \u2192 Gateway vs Upstream \u2192 Review slow traces \u2192 [View API Detail](/d/tyk-api-detail?var-api_id=${api_id})  \n**Panels:** [Latency P95](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=3) | [Latency Breakdown](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=13) | [Slow Traces](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=22)\n\n### \ud83d\udcc8 Traffic Anomaly (Spike or Drop)?\n**Steps:** Check Traffic Spike/Drop alerts \u2192 Review client IPs \u2192 Check portal apps \u2192 [View API Detail](/d/tyk-api-detail?var-api_id=${api_id})  \n**Panels:** [Traffic Alert](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=91) | [Client IPs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=28) | [Portal Apps](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=17)\n\n### \u26a0\ufe0f Connection Errors?\n**Steps:** Check Upstream Connection Failures \u2192 Verify backend services \u2192 Review network \u2192 [View API Detail](/d/tyk-api-detail?var-api_id=${api_id})  \n**Panels:** [Connection Errors](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=96) | [Upstream Health](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=30) | [Error Logs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=25)\n\n### \ud83d\udd12 Authentication Issues?\n**Steps:** Check Auth Failure panel \u2192 Review API keys \u2192 Check portal app permissions \u2192 [View API Detail](/d/tyk-api-detail?var-api_id=${api_id})  \n**Panels:** [Auth Failures](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=97) | [Top API Keys](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=19) | [Error Logs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=25)\n\n---\n\n## 3\ufe0f\u20e3 Correlation Tools - Deep Investigation\n\n- **\ud83d\udcca Metrics:** Use filters above to narrow by Gateway Instance, API ID, or Portal App\n- **\ud83d\udd0d Traces:** Click any Trace ID to see full waterfall view in Jaeger UI\n- **\ud83d\udcdd Logs:** Filter access logs by API/status/client for detailed request info\n- **\ud83d\udcc5 Time Range:** Use deployment annotations (green markers) to correlate issues with releases\n- **\ud83c\udfaf API Deep Dive:** Select an API from dropdown above and click [API Detail Dashboard](/d/tyk-api-detail?var-api_id=${api_id}) for focused analysis\n\n---\n\n## \ud83d\udcda Dashboard Sections - Quick Navigation\n\n[\ud83d\udd14 Active Alerts](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=99) | [\ud83d\udcca SLA/SLO](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health) | [\ud83d\udcc8 Golden Signals](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=100) | [\ud83d\udcc8 Traffic Patterns](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=102) | [\ud83d\udd0d Traces](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=103) | [\ud83d\udcdd Logs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=104)"
          }
        }
      ]
    },
    {
      "id": 99,
      "type": "row",
      "title": "System Health & Active Alerts",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 1
      },
      "collapsed": false
    },
    {
      "id": 90,
      "type": "stat",
      "title": "Overall System Health",
      "description": "Composite health indicator based on multiple signals:\n\n**Healthy**: All systems operating normally\n- Error rate < 1%\n- No traffic anomalies\n- Latency within acceptable range\n- All instances up\n\n**Degraded**: Some issues detected\n- Error rate 1-5%\n- Minor latency degradation\n- Traffic anomalies detected\n- Resource usage elevated\n\n**Critical**: Immediate attention required\n- Error rate > 5%\n- Severe latency issues\n- Major traffic anomalies\n- Instance failures\n\nClick for troubleshooting guide",
      "gridPos": {
        "h": 8,
        "w": 4,
        "x": 0,
        "y": 11
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  # Error rate score (0-100, lower is better)\n  clamp_max(\n    (\n      sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"4..|5..|-1\"}[5m]))\n      /\n      sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))\n    ) * 100 * 5,  # Multiply by 5 to make 5% error = 25 points\n    100\n  )\n  +\n  # Latency score (0-100, lower is better)\n  clamp_max(\n    histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le)) / 50,  # 5000ms = 100 points\n    100\n  )\n  +\n  # Instance health score (0-100, lower is better)\n  (\n    (count(up{job=\"tyk-gateway\", instance=~\"$instance\"}) - count(up{job=\"tyk-gateway\", instance=~\"$instance\"} == 1))\n    /\n    count(up{job=\"tyk-gateway\", instance=~\"$instance\"})\n  ) * 100\n) / 3",
          "refId": "A",
          "legendFormat": "Health Score"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value_and_name",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 16,
          "valueSize": 48
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 0,
          "mappings": [
            {
              "type": "range",
              "options": {
                "from": 0,
                "to": 20,
                "result": {
                  "text": "Healthy",
                  "color": "green"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 20,
                "to": 50,
                "result": {
                  "text": "Degraded",
                  "color": "yellow"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 50,
                "to": 100,
                "result": {
                  "text": "Critical",
                  "color": "red"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 20,
                "color": "yellow"
              },
              {
                "value": 50,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "\ud83d\udd17 View Step-by-Step Troubleshooting Guide",
          "url": "https://tyk.io/docs/troubleshooting",
          "targetBlank": true
        }
      ]
    },
    {
      "id": 91,
      "type": "stat",
      "title": "Traffic Spike Alert",
      "description": "**Traffic Spike Alert - Sudden Increase Detected**\n\nDetects sudden traffic increases that may indicate:\n- DDoS attack or bot traffic\n- Viral content or marketing campaign success  \n- Misconfigured client retry logic\n- Load test or synthetic traffic\n\n**Alert Thresholds:**\n- \ud83d\udfe2 Normal: Within expected range\n- \ud83d\udfe1 Warning: >50% increase in last 5 min\n- \ud83d\udd34 Critical: >100% increase (doubled traffic)\n\n---\n\n## \ud83d\udea8 Immediate Actions:\n1. **Check Error Rate panel** \u2192 High errors = likely attack, Low errors = legitimate spike\n2. **Review Top Client IPs** \u2192 Identify traffic source  \n3. **Check Portal Apps** \u2192 Which consumers are affected\n4. **Decision Point:** Enable rate limiting OR scale capacity\n\n## \ud83d\udcca Drill-Down Links:\n- [View Error Rate](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=2)\n- [View Top Client IPs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=28)  \n- [View Portal Apps](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=17)\n- [View API Error Breakdown](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=15)",
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 4,
        "y": 11
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))\n  /\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m] offset 5m))\n  - 1\n) * 100",
          "refId": "A",
          "legendFormat": "Traffic Change %"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 14,
          "valueSize": 32
        },
        "showPercentChange": false
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "mappings": [
            {
              "type": "special",
              "options": {
                "match": "null",
                "result": {
                  "text": "No Data",
                  "color": "text"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": -100,
                "to": 50,
                "result": {
                  "text": "Normal"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 50,
                "to": 100,
                "result": {
                  "text": "Spike Detected"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 100,
                "to": 10000,
                "result": {
                  "text": "Major Spike"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 50,
                "color": "yellow"
              },
              {
                "value": 100,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Top Client IPs",
          "url": "/d/${__dashboard.uid}?viewPanel=28"
        },
        {
          "title": "View Portal Apps",
          "url": "/d/${__dashboard.uid}?viewPanel=17"
        }
      ]
    },
    {
      "id": 92,
      "type": "stat",
      "title": "Traffic Drop Alert",
      "description": "**Traffic Drop Alert - Sudden Decrease Detected**\n\nDetects sudden traffic drops that may indicate:\n- Service outage or network issue\n- Client-side failures\n- DNS or routing problems\n- Upstream API dependencies down\n\n**Alert Thresholds:**\n- \ud83d\udfe2 Normal: Within expected range\n- \ud83d\udfe1 Warning: >30% decrease in last 5 min\n- \ud83d\udd34 Critical: >50% decrease (traffic halved)\n\n---\n\n## \ud83d\udea8 Immediate Actions:\n1. **Check Gateway Instance Health** \u2192 Are instances responding?\n2. **Review Connection Errors** \u2192 Backend connectivity issues?\n3. **Check recent deployments** \u2192 Did deployment cause the drop?\n4. **Verify DNS/Network** \u2192 Can clients reach the gateway?\n\n## \ud83d\udcca Drill-Down Links:\n- [View Gateway Instances](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=8)\n- [View Connection Errors](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=96)\n- [View Error Logs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=25)",
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 9,
        "y": 11
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  1 - \n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))\n  /\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m] offset 5m))\n) * 100",
          "refId": "A",
          "legendFormat": "Traffic Drop %"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 14,
          "valueSize": 32
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "mappings": [
            {
              "type": "special",
              "options": {
                "match": "null",
                "result": {
                  "text": "No Data",
                  "color": "text"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": -10000,
                "to": 0,
                "result": {
                  "text": "Normal"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 0,
                "to": 50,
                "result": {
                  "text": "Normal"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 50,
                "to": 80,
                "result": {
                  "text": "Drop Detected"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 80,
                "to": 100,
                "result": {
                  "text": "Major Drop"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 50,
                "color": "yellow"
              },
              {
                "value": 80,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Gateway Instances",
          "url": "/d/${__dashboard.uid}?viewPanel=8"
        },
        {
          "title": "View Error Logs",
          "url": "/d/${__dashboard.uid}?viewPanel=25"
        }
      ]
    },
    {
      "id": 93,
      "type": "stat",
      "title": "Error Rate Surge",
      "description": "**Error Rate Surge - High Error Percentage**\n\nDetects elevated error rates that may indicate:\n- Backend service failures\n- Invalid API configurations\n- Authentication/authorization issues\n- Gateway overload or resource exhaustion\n\n**Alert Thresholds:**\n- \ud83d\udfe2 Normal: < 1% error rate\n- \ud83d\udfe1 Warning: 1-5% error rate\n- \ud83d\udd34 Critical: > 5% error rate\n\n---\n\n## \ud83d\udea8 Immediate Actions:\n1. **Check Error Traces panel** \u2192 Find affected APIs and error types\n2. **Review Upstream Health** \u2192 Backend issue OR gateway issue?\n3. **Check recent deployments** \u2192 Correlation with changes?\n4. **Examine error patterns** \u2192 Specific status codes (401/403/500/502)?\n\n## \ud83d\udcca Drill-Down Links:\n- [View Error Traces](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=23)\n- [View Upstream Health](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=30)\n- [View Error Logs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=25)\n- [View Status Code Distribution](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=11)",
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 14,
        "y": 11
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"4..|5..|-1\"}[5m]))\n  /\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"4..|5..|-1\"}[5m] offset 5m))\n)",
          "refId": "A",
          "legendFormat": "Error Rate Multiplier"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 14,
          "valueSize": 32
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 1,
          "mappings": [
            {
              "type": "special",
              "options": {
                "match": "null",
                "result": {
                  "text": "No Errors",
                  "color": "green"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 0,
                "to": 2,
                "result": {
                  "text": "Normal"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 2,
                "to": 5,
                "result": {
                  "text": "Surge Detected"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 5,
                "to": 10000,
                "result": {
                  "text": "Critical Surge"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 2,
                "color": "yellow"
              },
              {
                "value": 5,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Error Breakdown",
          "url": "/d/${__dashboard.uid}?viewPanel=15"
        },
        {
          "title": "View Error Traces",
          "url": "/d/${__dashboard.uid}?viewPanel=23"
        }
      ]
    },
    {
      "id": 94,
      "type": "stat",
      "title": "Latency Degradation",
      "description": "**Latency Degradation - Performance Slowdown**\n\nDetects performance degradation that may indicate:\n- Backend service slowdown\n- Database query performance issues\n- Gateway resource saturation\n- Network latency problems\n\n**Alert Thresholds:**\n- \ud83d\udfe2 Normal: P95 < 500ms\n- \ud83d\udfe1 Warning: P95 500ms-1000ms  \n- \ud83d\udd34 Critical: P95 > 1000ms\n\n---\n\n## \ud83d\udea8 Immediate Actions:\n1. **Check Latency Breakdown** \u2192 Gateway OR Upstream slowdown?\n2. **If Upstream:** Review Upstream Service Health panel\n3. **If Gateway:** Check Saturation panel \u2192 Resource exhaustion?\n4. **Review Slow Traces** \u2192 Identify specific bottleneck operations\n\n## \ud83d\udcca Drill-Down Links:\n- [View Latency Breakdown](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=13)\n- [View Slow Traces](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=22)\n- [View Upstream Health](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=30)\n- [View Saturation](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=4)",
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 19,
        "y": 11
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "A",
          "legendFormat": "Current P95"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m] offset 5m)) by (le))",
          "refId": "B",
          "legendFormat": "Previous P95"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value",
        "reduceOptions": {
          "values": false,
          "fields": "/^Current P95$/",
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 14,
          "valueSize": 28
        },
        "showPercentChange": true,
        "percentChangeColorMode": "inverted"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 1000,
                "color": "yellow"
              },
              {
                "value": 5000,
                "color": "red"
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Current P95"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "P95 Latency"
              }
            ]
          }
        ]
      },
      "links": [
        {
          "title": "View Latency Breakdown",
          "url": "/d/${__dashboard.uid}?viewPanel=13"
        },
        {
          "title": "View Slow Requests",
          "url": "/d/${__dashboard.uid}?viewPanel=22"
        }
      ]
    },
    {
      "id": 95,
      "type": "stat",
      "title": "Gateway Instance Failures",
      "description": "**Gateway Instance Failures - Instances Down**\n\nDetects gateway instance health issues:\n- Instance crashes or restarts\n- Container/pod failures\n- Node failures in Kubernetes\n- Health check failures\n\n**Alert Thresholds:**\n- \ud83d\udfe2 Normal: All instances healthy\n- \ud83d\udfe1 Warning: 1 instance down\n- \ud83d\udd34 Critical: Multiple instances down\n\n---\n\n## \ud83d\udea8 Immediate Actions:\n1. **Check Gateway Instances panel** \u2192 Which instances are down?\n2. **Review gateway logs** \u2192 Why did instance fail?\n3. **Check infrastructure metrics** \u2192 Resource constraints?\n4. **Verify auto-scaling** \u2192 Are replacements coming up?\n\n## \ud83d\udcca Drill-Down Links:\n- [View Gateway Instances](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=8)\n- [View Gateway Logs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=24)\n- [View Saturation](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=4)",
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 4,
        "y": 15
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "count(up{job=\"tyk-gateway\", instance=~\"$instance\"} == 0) OR on() vector(0)",
          "refId": "A",
          "legendFormat": "Failed Instances"
        },
        {
          "expr": "count(up{job=\"tyk-gateway\", instance=~\"$instance\"})",
          "refId": "B",
          "legendFormat": "Total Instances"
        }
      ],
      "options": {
        "graphMode": "none",
        "colorMode": "background",
        "textMode": "value",
        "reduceOptions": {
          "values": false,
          "fields": "/^Failed Instances$/",
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 14,
          "valueSize": 32
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 0,
          "mappings": [
            {
              "type": "value",
              "options": {
                "0": {
                  "text": "All Healthy",
                  "color": "green"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 1,
                "to": 1,
                "result": {
                  "text": "1 Instance Down",
                  "color": "yellow"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 2,
                "to": 100,
                "result": {
                  "text": "Multiple Failures",
                  "color": "red"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 1,
                "color": "yellow"
              },
              {
                "value": 2,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Gateway Instances",
          "url": "/d/${__dashboard.uid}?viewPanel=8"
        },
        {
          "title": "View Gateway Logs",
          "url": "/d/${__dashboard.uid}?viewPanel=24"
        }
      ]
    },
    {
      "id": 96,
      "type": "stat",
      "title": "Upstream Connection Failures",
      "description": "**Upstream Connection Failures - Backend Unreachable**\n\nDetects backend connectivity issues:\n- Upstream services down or unreachable\n- Network connectivity problems\n- DNS resolution failures\n- Connection timeout issues\n\n**Alert Thresholds:**\n- \ud83d\udfe2 Normal: < 0.1% connection errors\n- \ud83d\udfe1 Warning: 0.1-1% connection errors\n- \ud83d\udd34 Critical: > 1% connection errors (HTTP code -1)\n\n---\n\n## \ud83d\udea8 Immediate Actions:\n1. **Check Upstream Connection Errors panel** \u2192 Which APIs/services affected?\n2. **Review Upstream Service Health** \u2192 Are backends responding?\n3. **Verify network connectivity** \u2192 Can gateway reach backends?\n4. **Check backend logs** \u2192 Are services healthy?\n\n## \ud83d\udcca Drill-Down Links:\n- [View Connection Errors](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=16)\n- [View Upstream Health](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=30)\n- [View Error Logs](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=25)",
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 9,
        "y": 15
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=\"-1\"}[5m]))\n  /\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))\n) * 100",
          "refId": "A",
          "legendFormat": "Connection Error %"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 14,
          "valueSize": 32
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "mappings": [
            {
              "type": "special",
              "options": {
                "match": "null",
                "result": {
                  "text": "No Errors",
                  "color": "green"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 0,
                "to": 0.1,
                "result": {
                  "text": "Healthy"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 0.1,
                "to": 1,
                "result": {
                  "text": "Degraded"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 1,
                "to": 100,
                "result": {
                  "text": "Critical"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 0.1,
                "color": "yellow"
              },
              {
                "value": 1,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Connection Errors",
          "url": "/d/${__dashboard.uid}?viewPanel=16"
        },
        {
          "title": "View Upstream Health",
          "url": "/d/${__dashboard.uid}?viewPanel=30"
        }
      ]
    },
    {
      "id": 97,
      "type": "stat",
      "title": "Authentication Failures",
      "description": "**Authentication Failures - Auth Issues Detected**\n\nDetects authentication/authorization problems:\n- Invalid API keys or tokens\n- Expired credentials\n- Misconfigured auth policies\n- Rate limiting of specific keys\n\n**Alert Thresholds:**\n- \ud83d\udfe2 Normal: < 1% auth failures\n- \ud83d\udfe1 Warning: 1-5% auth failures (401/403)\n- \ud83d\udd34 Critical: > 5% auth failures\n\n---\n\n## \ud83d\udea8 Immediate Actions:\n1. **Check Top API Keys panel** \u2192 Which keys are failing?\n2. **Review auth error patterns** \u2192 401 (invalid) vs 403 (forbidden)?\n3. **Check Portal App permissions** \u2192 Correct access policies?\n4. **Verify key expiration** \u2192 Are credentials still valid?\n\n## \ud83d\udcca Drill-Down Links:\n- [View Top API Keys](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=19)\n- [View Error Logs (filtered for 401/403)](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=25)\n- [View Portal App Performance](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=18)",
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 14,
        "y": 15
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"401|403\"}[5m]))\n  /\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))\n) * 100",
          "refId": "A",
          "legendFormat": "Auth Failure %"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 14,
          "valueSize": 32
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "mappings": [
            {
              "type": "special",
              "options": {
                "match": "null",
                "result": {
                  "text": "No Failures",
                  "color": "green"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 0,
                "to": 1,
                "result": {
                  "text": "Normal"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 1,
                "to": 5,
                "result": {
                  "text": "Elevated"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 5,
                "to": 100,
                "result": {
                  "text": "Critical"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 1,
                "color": "yellow"
              },
              {
                "value": 5,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Top API Keys",
          "url": "/d/${__dashboard.uid}?viewPanel=19"
        },
        {
          "title": "View Error Logs",
          "url": "/d/${__dashboard.uid}?viewPanel=25"
        }
      ]
    },
    {
      "id": 98,
      "type": "stat",
      "title": "Rate Limit Violations",
      "description": "**Rate Limit Violations - Quota Exceeded**\n\nDetects rate limiting activity:\n- Clients exceeding quota limits\n- Potential API abuse\n- Misconfigured rate limits\n- Legitimate high-volume consumers\n\n**Alert Thresholds:**\n- \ud83d\udfe2 Normal: < 0.5% rate limited (429 status)\n- \ud83d\udfe1 Warning: 0.5-2% rate limited\n- \ud83d\udd34 Critical: > 2% rate limited\n\n---\n\n## \ud83d\udea8 Immediate Actions:\n1. **Check Top API Keys panel** \u2192 Which consumers are hitting limits?\n2. **Review Portal Apps** \u2192 Legitimate usage or abuse?\n3. **Check rate limit policies** \u2192 Are limits appropriate?\n4. **Decision:** Adjust limits OR enforce current policy\n\n## \ud83d\udcca Drill-Down Links:\n- [View Top API Keys](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=19)\n- [View Portal App Performance](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=18)\n- [View Error Logs (filtered for 429)](/d/tyk-api-performance-health/tyk-gateway-api-performance-and-health?viewPanel=25)",
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 19,
        "y": 15
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=\"429\"}[5m]))\n  /\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))\n) * 100",
          "refId": "A",
          "legendFormat": "Rate Limited %"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 14,
          "valueSize": 32
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "mappings": [
            {
              "type": "special",
              "options": {
                "match": "null",
                "result": {
                  "text": "No Limits Hit",
                  "color": "green"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 0,
                "to": 1,
                "result": {
                  "text": "Normal"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 1,
                "to": 5,
                "result": {
                  "text": "Moderate"
                }
              }
            },
            {
              "type": "range",
              "options": {
                "from": 5,
                "to": 100,
                "result": {
                  "text": "High Activity"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 1,
                "color": "yellow"
              },
              {
                "value": 5,
                "color": "orange"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Top API Keys",
          "url": "/d/${__dashboard.uid}?viewPanel=19"
        },
        {
          "title": "View Portal Apps",
          "url": "/d/${__dashboard.uid}?viewPanel=18"
        }
      ]
    },
    {
      "id": 100,
      "type": "row",
      "title": "Golden Signals - API Health (Gateway: $instance, API: $api_id)",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 19
      },
      "collapsed": false
    },
    {
      "id": 1,
      "type": "stat",
      "title": "Request Rate (Traffic)",
      "description": "Total requests per second across all selected APIs and gateways. Indicates current API traffic volume. Use this to detect traffic spikes, drops, or normal patterns.",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 0,
        "y": 20
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))",
          "refId": "A",
          "legendFormat": "Request Rate"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "textMode": "value_and_name",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 16,
          "valueSize": 32
        },
        "showPercentChange": true,
        "percentChangeColorMode": "standard"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 2,
          "mappings": [],
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "blue"
              },
              {
                "value": 10,
                "color": "green"
              },
              {
                "value": 100,
                "color": "yellow"
              },
              {
                "value": 500,
                "color": "orange"
              }
            ]
          }
        }
      }
    },
    {
      "id": 2,
      "type": "stat",
      "title": "Error Rate",
      "description": "Percentage of requests resulting in errors (4xx and 5xx status codes). A healthy API should have <1% error rate. Elevated error rates require immediate investigation.",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 6,
        "y": 20
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"4..|5..|-1\"}[5m]))\n  /\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))\n) * 100",
          "refId": "A",
          "legendFormat": "Error Rate"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value_and_name",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 16,
          "valueSize": 32
        },
        "showPercentChange": true,
        "percentChangeColorMode": "inverted"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "min": 0,
          "max": 100,
          "mappings": [],
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 1,
                "color": "yellow"
              },
              {
                "value": 5,
                "color": "orange"
              },
              {
                "value": 10,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Error Traces (4xx/5xx)",
          "url": "/d/${__dashboard.uid}?viewPanel=23",
          "targetBlank": false
        },
        {
          "title": "View Error Logs",
          "url": "/d/${__dashboard.uid}?viewPanel=25",
          "targetBlank": false
        },
        {
          "title": "Search Errors in Jaeger",
          "url": "http://localhost:8085/jaeger/ui/search?service=tyk-gateway&tags=%7B%22error%22%3A%22true%22%7D",
          "targetBlank": true
        }
      ]
    },
    {
      "id": 3,
      "type": "stat",
      "title": "Latency P95",
      "description": "95th percentile response time - 95% of requests complete faster than this value. Use this to understand typical user experience. P95 > 1000ms indicates performance issues.",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 12,
        "y": 20
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "A",
          "legendFormat": "P95 Latency"
        },
        {
          "expr": "histogram_quantile(0.50, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "B",
          "legendFormat": "P50 Latency"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "C",
          "legendFormat": "P99 Latency"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "textMode": "value_and_name",
        "reduceOptions": {
          "values": false,
          "fields": "P95 Latency",
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 16,
          "valueSize": 28
        },
        "showPercentChange": true,
        "percentChangeColorMode": "inverted"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "mappings": [],
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 200,
                "color": "yellow"
              },
              {
                "value": 1000,
                "color": "orange"
              },
              {
                "value": 5000,
                "color": "red"
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "P50 Latency"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "P50 (Median)"
              }
            ]
          }
        ]
      },
      "links": [
        {
          "title": "View Slow Traces (>1000ms)",
          "url": "/d/${__dashboard.uid}?viewPanel=22",
          "targetBlank": false
        },
        {
          "title": "View Latency Breakdown",
          "url": "/d/${__dashboard.uid}?viewPanel=13",
          "targetBlank": false
        },
        {
          "title": "View Slow Request Logs",
          "url": "/d/${__dashboard.uid}?viewPanel=26",
          "targetBlank": false
        }
      ]
    },
    {
      "id": 4,
      "type": "gauge",
      "title": "Saturation (Capacity)",
      "description": "Composite metric showing gateway resource utilization. Combines CPU, memory, and connection usage. >80% indicates the system is approaching capacity limits.",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 18,
        "y": 20
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  (avg(rate(process_cpu_seconds_total{job=\"tyk-gateway\", instance=~\"$instance\"}[5m]) * 100) * 0.4) +\n  (avg((tyk_gateway_system_memory_alloc_bytes{instance=~\"$instance\"} / tyk_gateway_system_memory_total_bytes{instance=~\"$instance\"}) * 100) * 0.4) +\n  (avg((tyk_gateway_system_open_connections{instance=~\"$instance\"} / 1000) * 100) * 0.2)\n)",
          "refId": "A",
          "legendFormat": "Saturation"
        }
      ],
      "options": {
        "showThresholdLabels": true,
        "showThresholdMarkers": true,
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "text": {
          "titleSize": 16,
          "valueSize": 28
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "min": 0,
          "max": 100,
          "mappings": [],
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 60,
                "color": "yellow"
              },
              {
                "value": 80,
                "color": "orange"
              },
              {
                "value": 90,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 201,
      "type": "row",
      "title": "SLA/SLO Tracking - Service Level Objectives",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 26
      },
      "collapsed": false
    },
    {
      "id": 202,
      "type": "stat",
      "title": "Availability SLO (Target: 99.9%)",
      "description": "**Service Level Objective: 99.9% Availability**\n\nMeasures the percentage of successful requests (non-5xx, non-connection-error responses) over the selected time range.\n\n**Thresholds:**\n- \ud83d\udfe2 Green: > 99.95% (exceeding target)\n- \ud83d\udfe1 Yellow: 99.9% - 99.95% (meeting target)\n- \ud83d\udd34 Red: < 99.9% (SLO breach)\n\n**Current Status:** Shows real-time availability\n\n**Actions if Red:**\n1. Check Error Rate panel for error patterns\n2. Review Upstream Health for backend issues\n3. Check recent deployments (annotations)\n4. Investigate error traces for root cause",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 0,
        "y": 27
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(1 - (sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"5..|\u22121\"}[5m])) / sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m])))) * 100",
          "refId": "A",
          "legendFormat": "Availability %"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "textMode": "value_and_name",
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 3,
          "min": 99,
          "max": 100,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "red"
              },
              {
                "value": 99.9,
                "color": "yellow"
              },
              {
                "value": 99.95,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "id": 203,
      "type": "stat",
      "title": "Latency SLO (Target: P95 < 500ms)",
      "description": "**Service Level Objective: P95 Latency < 500ms**\n\nMeasures the 95th percentile latency - 95% of requests complete faster than this value.\n\n**Thresholds:**\n- \ud83d\udfe2 Green: < 500ms (meeting target)\n- \ud83d\udfe1 Yellow: 500-1000ms (degraded performance)\n- \ud83d\udd34 Red: > 1000ms (SLO breach)\n\n**Current Status:** Real-time P95 latency\n\n**Actions if Yellow/Red:**\n1. Check Latency Breakdown panel (Gateway vs Upstream)\n2. Review Slow Traces (>1000ms) for bottlenecks\n3. Check Saturation panel for resource constraints\n4. Investigate upstream service health",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 6,
        "y": 27
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "A",
          "legendFormat": "P95 Latency"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "textMode": "value_and_name",
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 500,
                "color": "yellow"
              },
              {
                "value": 1000,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 204,
      "type": "gauge",
      "title": "Error Budget Remaining",
      "description": "**Error Budget: 0.1% over 30 days**\n\nBased on 99.9% availability SLO, you have a 0.1% error budget.\n\nThis panel shows:\n- **Percentage remaining** of your monthly error budget\n- How many errors you can afford before breaching SLO\n\n**Interpretation:**\n- \ud83d\udfe2 Green (> 50%): Healthy - plenty of budget remaining\n- \ud83d\udfe1 Yellow (25-50%): Caution - budget depleting\n- \ud83d\udd34 Red (< 25%): Critical - approaching SLO breach\n\n**Actions if Yellow/Red:**\n1. Prioritize fixing error-causing issues\n2. Review deployment practices\n3. Consider adjusting error budgets or SLOs\n4. Implement more aggressive error prevention",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 12,
        "y": 27
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  # Error budget = 0.1% of total requests over 30 days\n  # Remaining budget = (0.001 * total_requests) - actual_errors\n  (\n    (0.001 * sum(increase(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[30d])))\n    -\n    sum(increase(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"5..|\u22121\"}[30d]))\n  )\n  /\n  # Divide by total budget to get percentage remaining\n  (0.001 * sum(increase(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[30d])))\n) * 100",
          "refId": "A",
          "legendFormat": "Budget Remaining %"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "min": 0,
          "max": 100,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "red"
              },
              {
                "value": 25,
                "color": "yellow"
              },
              {
                "value": 50,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "id": 205,
      "type": "stat",
      "title": "SLO Burn Rate (Current vs Target)",
      "description": "**SLO Burn Rate Indicator**\n\nCompares current error rate to the acceptable error rate (0.1% for 99.9% SLO).\n\n**Burn Rate Multiplier:**\n- **1x**: Burning budget at expected rate (normal)\n- **> 2x**: Burning budget twice as fast (warning)\n- **> 10x**: Burning budget 10x faster (critical)\n\n**What it means:**\n- If burning at 10x rate, you'll exhaust monthly budget in 3 days\n- If burning at 2x rate, budget depletes in 15 days\n\n**Actions if High Burn Rate:**\n1. Immediate investigation of error sources\n2. Check if incident is ongoing\n3. Consider rolling back recent changes\n4. Alert on-call team if > 10x burn rate",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 18,
        "y": 27
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "(\n  # Current error rate\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"5..|\u22121\"}[5m]))\n  /\n  sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))\n)\n/\n# Acceptable error rate (0.1% for 99.9% SLO)\n0.001",
          "refId": "A",
          "legendFormat": "Burn Rate Multiplier"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        },
        "orientation": "auto",
        "textMode": "value_and_name",
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 2,
                "color": "yellow"
              },
              {
                "value": 10,
                "color": "red"
              }
            ]
          },
          "mappings": [
            {
              "type": "special",
              "options": {
                "match": "null",
                "result": {
                  "text": "No Data",
                  "color": "gray"
                }
              }
            }
          ]
        }
      }
    },
    {
      "id": 101,
      "type": "row",
      "title": "Supplementary Gateway Metrics (Gateway: $instance)",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 31
      },
      "collapsed": false
    },
    {
      "id": 5,
      "type": "stat",
      "title": "Active APIs",
      "description": "Number of APIs currently loaded and serving traffic. Use this to verify API deployments and track API inventory across gateway instances.",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 0,
        "y": 32
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "count(count by (api) (rate(tyk_http_status_total{instance=~\"$instance\"}[5m]) > 0))",
          "refId": "A",
          "legendFormat": "Active APIs with Traffic"
        },
        {
          "expr": "sum(tyk_gateway_gateway_apis_loaded{instance=~\"$instance\"})",
          "refId": "B",
          "legendFormat": "Total APIs Loaded"
        }
      ],
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "orientation": "auto",
        "textMode": "value_and_name",
        "wideLayout": true,
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "showPercentChange": false,
        "percentChangeColorMode": "standard"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 80,
                "color": "red"
              }
            ]
          },
          "color": {
            "mode": "palette-classic"
          },
          "decimals": 0,
          "unit": "short"
        },
        "overrides": []
      }
    },
    {
      "id": 6,
      "type": "stat",
      "title": "Active API Keys",
      "description": "Number of unique API keys making requests. Indicates active consumer count. Use to monitor API adoption and key usage patterns.",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 4,
        "y": 32
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "count(count by (api_key) (rate(tyk_http_status_per_path_and_org_and_app_total{api_id=~\"$api_id\", instance=~\"$instance\"}[5m]) > 0))",
          "refId": "A",
          "legendFormat": "Active Keys"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "textMode": "value_and_name",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 0,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "blue"
              },
              {
                "value": 10,
                "color": "green"
              },
              {
                "value": 100,
                "color": "yellow"
              }
            ]
          }
        }
      }
    },
    {
      "id": 7,
      "type": "stat",
      "title": "Trace Coverage",
      "description": "Percentage of requests with distributed traces. Calculated using span metrics from OpenTelemetry. High coverage (>95%) ensures complete observability.",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 8,
        "y": 32
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "sum(increase(tyk_gateway_gateway_http_requests_total{instance=~\"$instance\"}[5m]))",
          "refId": "A",
          "legendFormat": "Total Requests"
        },
        {
          "expr": "sum(increase(traces_span_metrics_calls_total{service_name=\"tyk-gateway\"}[5m]))",
          "refId": "B",
          "legendFormat": "Traced Requests"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "textMode": "value_and_name",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "min": 0,
          "max": 100,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "red"
              },
              {
                "value": 70,
                "color": "orange"
              },
              {
                "value": 85,
                "color": "yellow"
              },
              {
                "value": 95,
                "color": "green"
              }
            ]
          }
        }
      },
      "transformations": [
        {
          "id": "calculateField",
          "options": {
            "mode": "binary",
            "binary": {
              "left": "Traced Requests",
              "operator": "/",
              "right": "Total Requests"
            },
            "replaceFields": false,
            "alias": "Coverage Ratio"
          }
        },
        {
          "id": "calculateField",
          "options": {
            "mode": "binary",
            "binary": {
              "left": "Coverage Ratio",
              "operator": "*",
              "right": "100"
            },
            "replaceFields": true,
            "alias": "Trace Coverage %"
          }
        }
      ]
    },
    {
      "id": 8,
      "type": "stat",
      "title": "Gateway Instances",
      "description": "Number of healthy gateway instances currently serving traffic. Use to verify high availability setup and detect instance failures.",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 12,
        "y": 32
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "count(up{job=\"tyk-gateway\", instance=~\"$instance\"} == 1)",
          "refId": "A",
          "legendFormat": "Healthy Instances"
        },
        {
          "expr": "count(up{job=\"tyk-gateway\", instance=~\"$instance\"})",
          "refId": "B",
          "legendFormat": "Total Instances"
        }
      ],
      "options": {
        "graphMode": "none",
        "colorMode": "value",
        "textMode": "value_and_name",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        }
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 1
              },
              {
                "color": "green",
                "value": 2
              }
            ]
          },
          "color": {
            "mode": "thresholds"
          },
          "decimals": 0,
          "unit": "short"
        },
        "overrides": []
      }
    },
    {
      "id": 9,
      "type": "stat",
      "title": "Active Errors",
      "description": "Total error count in the last 5 minutes. Spikes indicate issues requiring immediate attention. Click to view error details in logs section below.",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 16,
        "y": 32
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "sum(increase(tyk_http_status_total{instance=~\"$instance\", code=~\"4..|5..|-1\"}[5m]))",
          "refId": "A",
          "legendFormat": "Error Count"
        }
      ],
      "options": {
        "graphMode": "area",
        "colorMode": "background",
        "textMode": "value_and_name",
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 0,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 10,
                "color": "yellow"
              },
              {
                "value": 50,
                "color": "orange"
              },
              {
                "value": 100,
                "color": "red"
              }
            ]
          }
        }
      },
      "links": [
        {
          "title": "View Error Logs",
          "url": "/d/${__dashboard.uid}?viewPanel=23"
        }
      ]
    },
    {
      "id": 102,
      "type": "row",
      "title": "Traffic Patterns & Trends (Gateway: $instance, API: $api_id)",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 38
      },
      "collapsed": false
    },
    {
      "id": 10,
      "type": "timeseries",
      "title": "Request Rate Over Time",
      "description": "Traffic patterns per API over time. Use to identify traffic trends, peaks, and anomalies. Grouped by API for easy comparison.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 39
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "sum by (api) (rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[1m]))",
          "refId": "A",
          "legendFormat": "{{api}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "calcs": [
            "lastNotNull",
            "max",
            "mean"
          ],
          "sortBy": "Max",
          "sortDesc": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 2,
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 10,
            "showPoints": "never",
            "spanNulls": true,
            "gradientMode": "opacity"
          },
          "color": {
            "mode": "palette-classic"
          }
        }
      },
      "links": [
        {
          "title": "View API Detail Dashboard",
          "url": "/d/tyk-api-detail?var-api_id=${__series.labels.api}&${__url_time_range}",
          "targetBlank": false
        }
      ]
    },
    {
      "id": 11,
      "type": "timeseries",
      "title": "Status Code Distribution",
      "description": "HTTP status code breakdown over time. Stacked view shows proportion of successful (2xx), client errors (4xx), and server errors (5xx). Use to spot error patterns.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 39
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"2..\"}[1m]))",
          "refId": "A",
          "legendFormat": "2xx Success"
        },
        {
          "expr": "sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"3..\"}[1m]))",
          "refId": "B",
          "legendFormat": "3xx Redirect"
        },
        {
          "expr": "sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"4..\"}[1m]))",
          "refId": "C",
          "legendFormat": "4xx Client Error"
        },
        {
          "expr": "sum(rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"5..|-1\"}[1m]))",
          "refId": "D",
          "legendFormat": "5xx Server Error"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true,
          "calcs": [
            "lastNotNull",
            "max",
            "mean"
          ]
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 2,
          "custom": {
            "drawStyle": "bars",
            "lineWidth": 0,
            "fillOpacity": 80,
            "gradientMode": "none",
            "stacking": {
              "mode": "normal",
              "group": "A"
            },
            "barAlignment": 0,
            "showPoints": "never"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "2xx Success"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "3xx Redirect"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "4xx Client Error"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "yellow",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "5xx Server Error"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": 12,
      "type": "timeseries",
      "title": "Latency Percentiles Over Time",
      "description": "Response time distribution showing P50 (median), P90, P95, and P99. P50 represents typical performance, P99 shows worst-case scenarios. Use to identify performance degradation and outliers.",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 47
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "A",
          "legendFormat": "P50 (Median)"
        },
        {
          "expr": "histogram_quantile(0.90, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "B",
          "legendFormat": "P90"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "C",
          "legendFormat": "P95"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "D",
          "legendFormat": "P99"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true,
          "calcs": [
            "lastNotNull",
            "max",
            "mean"
          ],
          "sortBy": "Mean",
          "sortDesc": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 0,
            "showPoints": "never",
            "spanNulls": true,
            "gradientMode": "none"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "P50 (Median)"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.lineWidth",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "P90"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "yellow",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.lineWidth",
                "value": 2
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "fill": "dash",
                  "dash": [
                    10,
                    5
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "P95"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "orange",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.lineWidth",
                "value": 3
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "fill": "dash",
                  "dash": [
                    10,
                    5
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "P99"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.lineWidth",
                "value": 3
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "fill": "dash",
                  "dash": [
                    5,
                    5
                  ]
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": 13,
      "type": "timeseries",
      "title": "Latency Breakdown (P95)",
      "description": "P95 latency split by component: Total (end-to-end), Gateway (middleware processing), and Upstream (backend service). Use to identify where bottlenecks occur - gateway or upstream services.",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 47
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "A",
          "legendFormat": "Total Latency"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"upstream\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "B",
          "legendFormat": "Upstream Latency"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"total\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le)) - histogram_quantile(0.95, sum(rate(tyk_latency_bucket{type=\"upstream\", instance=~\"$instance\", api=~\"$api_id\"}[5m])) by (le))",
          "refId": "C",
          "legendFormat": "Gateway Processing"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true,
          "calcs": [
            "lastNotNull",
            "max",
            "mean"
          ]
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 20,
            "showPoints": "never",
            "spanNulls": true,
            "stacking": {
              "mode": "none"
            }
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Total Latency"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Upstream Latency"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "purple",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Gateway Processing"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": 14,
      "type": "bargauge",
      "title": "Top 10 APIs by Request Volume (req/s)",
      "description": "APIs ranked by request rate. Click on any bar to access the context menu with drill-down options.\n\nRight-click or click the dots menu on any API to:\n- View API Detail Dashboard\n- Open traces in Jaeger\n- Edit API configuration",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 55
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "topk(10, sum by (api) (rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m])))",
          "refId": "A",
          "legendFormat": "{{api}}",
          "instant": true
        }
      ],
      "transformations": [
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "field": "Value",
                "desc": true
              }
            ]
          }
        }
      ],
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "showUnfilled": true,
        "text": {
          "titleSize": 12,
          "valueSize": 14
        },
        "minVizWidth": 0,
        "minVizHeight": 10,
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 2,
          "color": {
            "mode": "continuous-GrYlRd"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              }
            ]
          },
          "links": [
            {
              "title": "View API Detail Dashboard for ${__field.labels.api}",
              "url": "/d/tyk-api-detail?var-api_id=${__field.labels.api}&${__url_time_range}&var-instance=${instance}",
              "targetBlank": false
            },
            {
              "title": "View ${__field.labels.api} Traces in Jaeger",
              "url": "http://localhost:8085/jaeger/ui/search?service=tyk-gateway&tags=%7B%22tyk.api.id%22%3A%22${__field.labels.api}%22%7D",
              "targetBlank": true
            },
            {
              "title": "Edit ${__field.labels.api} in Tyk Dashboard",
              "url": "http://tyk-dashboard.localhost:3000/apis/designer/${__field.labels.api}",
              "targetBlank": true
            },
            {
              "title": "Filter Main Dashboard to ${__field.labels.api}",
              "url": "/d/tyk-api-performance-health?var-api_id=${__field.labels.api}&${__url_time_range}",
              "targetBlank": false
            }
          ]
        }
      }
    },
    {
      "id": 15,
      "type": "bargauge",
      "title": "Top 10 APIs by Error Rate",
      "description": "APIs with highest error percentages. Identify problematic APIs requiring immediate attention. Red bars indicate critical error rates (>5%). Click any API to view detailed metrics.",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 55
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "topk(10, (sum by (api) (rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=~\"4..|5..|-1\"}[5m])) / sum by (api) (rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\"}[5m]))) * 100)",
          "refId": "A",
          "legendFormat": "{{api}}",
          "instant": true
        }
      ],
      "transformations": [
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "field": "Value",
                "desc": true
              }
            ]
          }
        }
      ],
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "showUnfilled": true,
        "text": {
          "titleSize": 12,
          "valueSize": 14
        },
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ]
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "min": 0,
          "max": 100,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 1,
                "color": "yellow"
              },
              {
                "value": 5,
                "color": "orange"
              },
              {
                "value": 10,
                "color": "red"
              }
            ]
          },
          "links": [
            {
              "title": "View API Detail Dashboard for ${__field.labels.api}",
              "url": "/d/tyk-api-detail?var-api_id=${__field.labels.api}&${__url_time_range}&var-instance=${instance}",
              "targetBlank": false
            },
            {
              "title": "View ${__field.labels.api} Traces in Jaeger",
              "url": "http://localhost:8085/jaeger/ui/search?service=tyk-gateway&tags=%7B%22tyk.api.id%22%3A%22${__field.labels.api}%22%7D",
              "targetBlank": true
            }
          ]
        }
      }
    },
    {
      "id": 16,
      "type": "timeseries",
      "title": "Upstream Connection Errors (Code: -1)",
      "description": "Failed upstream connections over time. Spikes indicate backend service unavailability or network issues. Code -1 represents connection failures before any HTTP response.",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 47
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "sum by (api) (rate(tyk_http_status_total{instance=~\"$instance\", api=~\"$api_id\", code=\"-1\"}[1m]))",
          "refId": "A",
          "legendFormat": "{{api}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true,
          "calcs": [
            "lastNotNull",
            "max",
            "sum"
          ]
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 2,
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 30,
            "showPoints": "auto",
            "spanNulls": false
          },
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 0.1,
                "color": "yellow"
              },
              {
                "value": 1,
                "color": "red"
              }
            ]
          }
        }
      },
      "alert": {
        "name": "High Connection Errors",
        "conditions": [
          {
            "evaluator": {
              "params": [
                1
              ],
              "type": "gt"
            },
            "operator": {
              "type": "and"
            },
            "query": {
              "params": [
                "A",
                "5m",
                "now"
              ]
            },
            "reducer": {
              "params": [],
              "type": "avg"
            },
            "type": "query"
          }
        ],
        "executionErrorState": "alerting",
        "for": "5m",
        "frequency": "1m",
        "message": "Connection errors detected for APIs: Check upstream service health",
        "noDataState": "no_data"
      },
      "links": [
        {
          "title": "View API Detail Dashboard",
          "url": "/d/tyk-api-detail?var-api_id=${__series.labels.api}&${__url_time_range}",
          "targetBlank": false
        }
      ]
    },
    {
      "id": 17,
      "type": "table",
      "title": "Requests by Portal App",
      "description": "Traffic distribution across portal applications. Use to understand which applications consume most API resources and identify heavy users.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 63
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "sum by (portal_app) (increase(tyk_http_status_per_org_and_app_total{instance=~\"$instance\", api_id=~\"$api_id\", portal_app=~\"$portal_app\", portal_org=~\"$portal_org\"}[5m]))",
          "refId": "A",
          "legendFormat": "{{portal_app}}",
          "format": "table",
          "instant": true
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Time": true
            },
            "renameByName": {
              "portal_app": "Portal App",
              "Value": "Total Requests"
            }
          }
        },
        {
          "id": "sortBy",
          "options": {
            "sort": [
              {
                "field": "Total Requests",
                "desc": true
              }
            ]
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Total Requests",
            "desc": true
          }
        ],
        "footer": {
          "show": false
        }
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Total Requests"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "gradient-gauge"
              },
              {
                "id": "custom.width",
                "value": 200
              },
              {
                "id": "unit",
                "value": "short"
              },
              {
                "id": "decimals",
                "value": 0
              }
            ]
          }
        ]
      }
    },
    {
      "id": 18,
      "type": "table",
      "title": "Portal App Performance Summary (Requests, Errors, Latency)",
      "description": "Comprehensive view of portal app metrics: request rate, error rate, and average latency. Sort by any column to identify problematic applications. Red highlighting indicates apps exceeding error thresholds.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 63
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "sum by (portal_app) (rate(tyk_http_status_per_org_and_app_total{instance=~\"$instance\", api_id=~\"$api_id\", portal_app=~\"$portal_app\", portal_org=~\"$portal_org\"}[5m]))",
          "refId": "A",
          "format": "table",
          "instant": true
        },
        {
          "expr": "sum by (portal_app) (rate(tyk_http_status_per_org_and_app_total{instance=~\"$instance\", api_id=~\"$api_id\", portal_app=~\"$portal_app\", portal_org=~\"$portal_org\", response_code=~\"4..|5..|-1\"}[5m]))",
          "refId": "B",
          "format": "table",
          "instant": true
        },
        {
          "expr": "(sum by (portal_app) (rate(tyk_http_status_per_org_and_app_total{instance=~\"$instance\", api_id=~\"$api_id\", portal_app=~\"$portal_app\", portal_org=~\"$portal_org\", response_code=~\"4..|5..|-1\"}[5m])) / sum by (portal_app) (rate(tyk_http_status_per_org_and_app_total{instance=~\"$instance\", api_id=~\"$api_id\", portal_app=~\"$portal_app\", portal_org=~\"$portal_org\"}[5m]))) * 100",
          "refId": "C",
          "format": "table",
          "instant": true
        },
        {
          "expr": "avg by (portal_app) (rate(tyk_latency_per_path_and_org_and_app_sum{type=\"total\", instance=~\"$instance\", api_id=~\"$api_id\", portal_app=~\"$portal_app\"}[5m]) / rate(tyk_latency_per_path_and_org_and_app_count{type=\"total\", instance=~\"$instance\", api_id=~\"$api_id\", portal_app=~\"$portal_app\"}[5m]))",
          "refId": "D",
          "format": "table",
          "instant": true
        }
      ],
      "transformations": [
        {
          "id": "merge",
          "options": {}
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Time": true
            },
            "renameByName": {
              "portal_app": "Portal App",
              "Value #A": "Request Rate",
              "Value #B": "Error Count",
              "Value #C": "Error %",
              "Value #D": "Avg Latency (ms)"
            },
            "indexByName": {
              "portal_app": 0,
              "Value #A": 1,
              "Value #B": 2,
              "Value #C": 3,
              "Value #D": 4
            }
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Request Rate",
            "desc": true
          }
        ],
        "footer": {
          "show": false,
          "reducer": [
            "sum"
          ],
          "fields": [
            "Request Rate"
          ]
        }
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Total Requests"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "gradient-gauge"
              },
              {
                "id": "custom.width",
                "value": 200
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "% of Total"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "custom.displayMode",
                "value": "basic"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Trend"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "sparkline"
              },
              {
                "id": "custom.width",
                "value": 150
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Request Rate"
            },
            "properties": [
              {
                "id": "unit",
                "value": "reqps"
              },
              {
                "id": "decimals",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Error %"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 1,
                      "color": "yellow"
                    },
                    {
                      "value": 5,
                      "color": "red"
                    }
                  ]
                }
              },
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "decimals",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Avg Latency (ms)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              },
              {
                "id": "decimals",
                "value": 0
              },
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 500,
                      "color": "yellow"
                    },
                    {
                      "value": 2000,
                      "color": "red"
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Portal App"
            },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "Filter dashboard by this app",
                    "url": "/d/${__dashboard.uid}?var-portal_app=${__value.text}",
                    "targetBlank": false
                  },
                  {
                    "title": "View app in Tyk Developer Portal",
                    "url": "https://http://tyk-portal.localhost:3100/apps/${__value.text}",
                    "targetBlank": true
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    {
      "id": 19,
      "type": "table",
      "title": "Top API Keys by Traffic",
      "description": "Most active API keys ranked by request volume and error rate. Keys are partially masked for security. Use to identify high-volume consumers and detect problematic integrations.",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 55
      },
      "datasource": "${datasource_prometheus}",
      "targets": [
        {
          "expr": "topk(20, sum by (api_key) (rate(tyk_http_status_per_path_and_org_and_app_total{api_id=~\"$api_id\", instance=~\"$instance\"}[5m])))",
          "refId": "A",
          "format": "table",
          "instant": true
        },
        {
          "expr": "topk(20, sum by (api_key) (rate(tyk_http_status_per_path_and_org_and_app_total{api_id=~\"$api_id\", instance=~\"$instance\", code=~\"4..|5..|-1\"}[5m])))",
          "refId": "B",
          "format": "table",
          "instant": true
        }
      ],
      "transformations": [
        {
          "id": "merge",
          "options": {}
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Time": true
            },
            "renameByName": {
              "key": "API Key (Masked)",
              "Value #A": "Request Rate",
              "Value #B": "Error Rate"
            }
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Request Rate",
            "desc": true
          }
        ]
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto"
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Request Rate"
            },
            "properties": [
              {
                "id": "unit",
                "value": "reqps"
              },
              {
                "id": "decimals",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Error Rate"
            },
            "properties": [
              {
                "id": "unit",
                "value": "reqps"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 0.1,
                      "color": "yellow"
                    },
                    {
                      "value": 1,
                      "color": "red"
                    }
                  ]
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": 103,
      "type": "row",
      "title": "Distributed Tracing - Recent Traces",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 79
      },
      "collapsed": false
    },
    {
      "id": 20,
      "type": "table",
      "title": "Recent Traces",
      "description": "Recent distributed traces from Jaeger. This table shows basic trace information for all APIs and gateways. To filter by API ID or Gateway Instance, click the 'Open in Jaeger (with filters)' link to open the Jaeger UI with your current dashboard selections pre-filled. Click any Trace ID to view full trace details including API metadata, HTTP method, path, status code, and timing breakdown.",
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 80
      },
      "datasource": "${datasource_jaeger}",
      "targets": [
        {
          "queryType": "search",
          "service": "tyk-gateway",
          "operationName": "",
          "tags": "",
          "minDuration": "",
          "maxDuration": "",
          "limit": 50,
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "renameByName": {
              "traceID": "Trace ID",
              "traceName": "Operation",
              "startTime": "Timestamp",
              "duration": "Duration (ms)"
            },
            "indexByName": {
              "startTime": 0,
              "traceID": 1,
              "traceName": 2,
              "duration": 3
            }
          }
        },
        {
          "id": "sortBy",
          "options": {
            "sort": [
              {
                "field": "startTime",
                "desc": true
              }
            ]
          }
        }
      ],
      "links": [
        {
          "title": "Open in Jaeger (with filters)",
          "url": "http://localhost:8085/jaeger/ui/search?service=tyk-gateway&tags=%7B%22tyk.api.id%22%3A%22${api_id}%22%7D",
          "targetBlank": true
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Timestamp",
            "desc": true
          }
        ],
        "footer": {
          "show": false
        },
        "filterable": true
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false,
            "filterable": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Trace ID"
            },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "View in Jaeger",
                    "url": "http://localhost:8085/jaeger/ui/trace/${__value.text}",
                    "targetBlank": true
                  }
                ]
              },
              {
                "id": "custom.width",
                "value": 280
              },
              {
                "id": "custom.displayMode",
                "value": "color-text"
              },
              {
                "id": "color",
                "value": {
                  "mode": "fixed",
                  "fixedColor": "blue"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Status"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "type": "range",
                    "options": {
                      "from": 200,
                      "to": 299,
                      "result": {
                        "color": "green",
                        "text": "2xx"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 300,
                      "to": 399,
                      "result": {
                        "color": "blue",
                        "text": "3xx"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 400,
                      "to": 499,
                      "result": {
                        "color": "yellow",
                        "text": "4xx"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 500,
                      "to": 599,
                      "result": {
                        "color": "red",
                        "text": "5xx"
                      }
                    }
                  }
                ]
              },
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Duration (ms)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.displayMode",
                "value": "lcd-gauge"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 500,
                      "color": "yellow"
                    },
                    {
                      "value": 2000,
                      "color": "orange"
                    },
                    {
                      "value": 5000,
                      "color": "red"
                    }
                  ]
                }
              },
              {
                "id": "custom.width",
                "value": 150
              },
              {
                "id": "min",
                "value": 0
              },
              {
                "id": "max",
                "value": 5000
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Spans"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Timestamp"
            },
            "properties": [
              {
                "id": "unit",
                "value": "dateTimeFromNow"
              },
              {
                "id": "custom.width",
                "value": 150
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Path"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 200
              }
            ]
          }
        ]
      }
    },
    {
      "id": 21,
      "type": "histogram",
      "title": "Trace Duration Distribution",
      "description": "Distribution of request durations from Jaeger traces. Shows how response times are spread across all requests. Most requests should cluster in lower buckets (<500ms). Long tail indicates outliers requiring investigation. Use to understand performance characteristics and identify patterns.",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 92
      },
      "datasource": "${datasource_jaeger}",
      "targets": [
        {
          "queryType": "search",
          "service": "tyk-gateway",
          "operationName": "",
          "tags": "",
          "minDuration": "",
          "maxDuration": "",
          "limit": 1000,
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "includeByName": {
              "duration": true
            },
            "renameByName": {
              "duration": "Duration (ms)"
            }
          }
        },
        {
          "id": "convertFieldType",
          "options": {
            "conversions": [
              {
                "targetField": "Duration (ms)",
                "destinationType": "number"
              }
            ]
          }
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true,
          "calcs": [
            "count",
            "mean",
            "max"
          ]
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "custom": {
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            },
            "scaleDistribution": {
              "type": "linear"
            }
          },
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 500,
                "color": "yellow"
              },
              {
                "value": 2000,
                "color": "orange"
              },
              {
                "value": 5000,
                "color": "red"
              }
            ]
          },
          "links": [
            {
              "title": "View traces in this duration range in Jaeger",
              "url": "http://localhost:8085/jaeger/ui/search?service=tyk-gateway&minDuration=${__value.numeric}ms&maxDuration=${__value.numeric}ms",
              "targetBlank": true
            }
          ]
        }
      }
    },
    {
      "id": 22,
      "type": "table",
      "title": "Slowest Traces (>1000ms)",
      "description": "Traces exceeding 1 second response time from Jaeger. These represent poor user experience and require optimization. Click trace ID to investigate root cause in Jaeger waterfall view - identify slow database queries, external API calls, or middleware bottlenecks. Sorted by duration (slowest first). Use the panel menu (\u22ee) to view all slow traces in Jaeger.",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 92
      },
      "datasource": "${datasource_jaeger}",
      "targets": [
        {
          "queryType": "search",
          "service": "tyk-gateway",
          "operationName": "",
          "tags": "",
          "minDuration": "1000ms",
          "maxDuration": "",
          "limit": 50,
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "extractFields",
          "options": {
            "source": "tags",
            "format": "json",
            "replace": false,
            "keepTime": false
          }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "serviceName": true,
              "serviceNamespace": true,
              "tags": true,
              "operationName": true
            },
            "renameByName": {
              "traceID": "Trace ID",
              "startTime": "Time",
              "duration": "Duration (ms)",
              "spanCount": "Spans",
              "tags.tyk.api.name": "API",
              "tags.http.method": "Method",
              "tags.http.target": "Path",
              "tags.http.status_code": "Status",
              "tags.tyk.upstream.latency_ms": "Upstream (ms)"
            },
            "indexByName": {
              "Time": 0,
              "Trace ID": 1,
              "API": 2,
              "Method": 3,
              "Path": 4,
              "Status": 5,
              "Duration (ms)": 6,
              "Upstream (ms)": 7,
              "Spans": 8
            }
          }
        },
        {
          "id": "sortBy",
          "options": {
            "sort": [
              {
                "field": "Duration (ms)",
                "desc": true
              }
            ]
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Duration (ms)",
            "desc": true
          }
        ],
        "footer": {
          "show": true,
          "reducer": [
            "count"
          ],
          "fields": [
            "Trace ID"
          ]
        },
        "filterable": true
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false,
            "filterable": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Trace ID"
            },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "View in Jaeger",
                    "url": "http://localhost:8085/jaeger/ui/trace/${__value.text}",
                    "targetBlank": true
                  }
                ]
              },
              {
                "id": "custom.width",
                "value": 280
              },
              {
                "id": "custom.displayMode",
                "value": "color-text"
              },
              {
                "id": "color",
                "value": {
                  "mode": "fixed",
                  "fixedColor": "blue"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Duration (ms)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.displayMode",
                "value": "gradient-gauge"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 1000,
                      "color": "yellow"
                    },
                    {
                      "value": 3000,
                      "color": "orange"
                    },
                    {
                      "value": 5000,
                      "color": "red"
                    }
                  ]
                }
              },
              {
                "id": "custom.width",
                "value": 150
              },
              {
                "id": "min",
                "value": 1000
              },
              {
                "id": "max",
                "value": 10000
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Upstream (ms)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 500,
                      "color": "yellow"
                    },
                    {
                      "value": 2000,
                      "color": "red"
                    }
                  ]
                }
              },
              {
                "id": "custom.width",
                "value": 120
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Status"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "type": "range",
                    "options": {
                      "from": 200,
                      "to": 299,
                      "result": {
                        "color": "green"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 300,
                      "to": 399,
                      "result": {
                        "color": "blue"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 400,
                      "to": 499,
                      "result": {
                        "color": "yellow"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 500,
                      "to": 599,
                      "result": {
                        "color": "red"
                      }
                    }
                  }
                ]
              },
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Spans"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 70
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "unit",
                "value": "dateTimeFromNow"
              },
              {
                "id": "custom.width",
                "value": 150
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Method"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Path"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 180
              }
            ]
          }
        ]
      },
      "links": [
        {
          "title": "View All Slow Traces in Jaeger (>1000ms)",
          "url": "http://localhost:8085/jaeger/ui/search?service=tyk-gateway&minDuration=1000ms",
          "targetBlank": true
        }
      ]
    },
    {
      "id": 23,
      "type": "table",
      "title": "Error Traces (4xx/5xx)",
      "description": "Recent traces with error status codes from Jaeger. Yellow rows indicate client errors (4xx - bad requests, auth failures, not found). Red rows indicate server errors (5xx - backend failures, timeouts, internal errors). Click trace ID to investigate full error context in Jaeger waterfall view. Use the panel menu (\u22ee) to view all error traces in Jaeger.",
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 92
      },
      "datasource": "${datasource_jaeger}",
      "targets": [
        {
          "queryType": "search",
          "service": "tyk-gateway",
          "operationName": "",
          "tags": "error=true",
          "minDuration": "",
          "maxDuration": "",
          "limit": 50,
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "extractFields",
          "options": {
            "source": "tags",
            "format": "json",
            "replace": false,
            "keepTime": false
          }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "serviceName": true,
              "serviceNamespace": true,
              "tags": true,
              "operationName": true
            },
            "renameByName": {
              "traceID": "Trace ID",
              "startTime": "Time",
              "duration": "Duration (ms)",
              "spanCount": "Spans",
              "tags.tyk.api.name": "API",
              "tags.http.method": "Method",
              "tags.http.target": "Path",
              "tags.http.status_code": "Status",
              "tags.error.message": "Error Message"
            },
            "indexByName": {
              "Time": 0,
              "Trace ID": 1,
              "API": 2,
              "Method": 3,
              "Path": 4,
              "Status": 5,
              "Duration (ms)": 6,
              "Error Message": 7
            }
          }
        },
        {
          "id": "filterByValue",
          "options": {
            "filters": [
              {
                "fieldName": "Status",
                "config": {
                  "id": "range",
                  "options": {
                    "from": 400,
                    "to": 599
                  }
                }
              }
            ],
            "type": "include",
            "match": "any"
          }
        },
        {
          "id": "sortBy",
          "options": {
            "sort": [
              {
                "field": "Time",
                "desc": true
              }
            ]
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Time",
            "desc": true
          }
        ],
        "footer": {
          "show": true,
          "reducer": [
            "count"
          ],
          "fields": [
            "Trace ID"
          ],
          "countRows": false
        },
        "filterable": true
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false,
            "filterable": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Trace ID"
            },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "View in Jaeger",
                    "url": "http://localhost:8085/jaeger/ui/trace/${__value.text}",
                    "targetBlank": true
                  }
                ]
              },
              {
                "id": "custom.width",
                "value": 280
              },
              {
                "id": "custom.displayMode",
                "value": "color-text"
              },
              {
                "id": "color",
                "value": {
                  "mode": "fixed",
                  "fixedColor": "blue"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Status"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "type": "value",
                    "options": {
                      "400": {
                        "color": "yellow",
                        "text": "400 Bad Request"
                      }
                    }
                  },
                  {
                    "type": "value",
                    "options": {
                      "401": {
                        "color": "yellow",
                        "text": "401 Unauthorized"
                      }
                    }
                  },
                  {
                    "type": "value",
                    "options": {
                      "403": {
                        "color": "yellow",
                        "text": "403 Forbidden"
                      }
                    }
                  },
                  {
                    "type": "value",
                    "options": {
                      "404": {
                        "color": "yellow",
                        "text": "404 Not Found"
                      }
                    }
                  },
                  {
                    "type": "value",
                    "options": {
                      "429": {
                        "color": "orange",
                        "text": "429 Rate Limited"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 400,
                      "to": 499,
                      "result": {
                        "color": "yellow",
                        "text": "4xx Client Error"
                      }
                    }
                  },
                  {
                    "type": "value",
                    "options": {
                      "500": {
                        "color": "red",
                        "text": "500 Internal Error"
                      }
                    }
                  },
                  {
                    "type": "value",
                    "options": {
                      "502": {
                        "color": "red",
                        "text": "502 Bad Gateway"
                      }
                    }
                  },
                  {
                    "type": "value",
                    "options": {
                      "503": {
                        "color": "red",
                        "text": "503 Service Unavailable"
                      }
                    }
                  },
                  {
                    "type": "value",
                    "options": {
                      "504": {
                        "color": "red",
                        "text": "504 Gateway Timeout"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 500,
                      "to": 599,
                      "result": {
                        "color": "red",
                        "text": "5xx Server Error"
                      }
                    }
                  }
                ]
              },
              {
                "id": "custom.width",
                "value": 160
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Duration (ms)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 1000,
                      "color": "yellow"
                    },
                    {
                      "value": 5000,
                      "color": "red"
                    }
                  ]
                }
              },
              {
                "id": "custom.width",
                "value": 120
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "unit",
                "value": "dateTimeFromNow"
              },
              {
                "id": "custom.width",
                "value": 150
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Method"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Path"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 180
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Error Message"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 250
              },
              {
                "id": "custom.displayMode",
                "value": "color-text"
              },
              {
                "id": "color",
                "value": {
                  "mode": "fixed",
                  "fixedColor": "red"
                }
              }
            ]
          }
        ]
      },
      "links": [
        {
          "title": "View All Error Traces in Jaeger",
          "url": "http://localhost:8085/jaeger/ui/search?service=tyk-gateway&tags=%7B%22error%22%3A%22true%22%7D",
          "targetBlank": true
        }
      ]
    },
    {
      "id": 104,
      "type": "row",
      "title": "Log Analysis - Gateway Access & Error Logs",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 96
      },
      "collapsed": false
    },
    {
      "id": 24,
      "type": "logs",
      "title": "Gateway Access Logs",
      "description": "Real-time gateway access logs for all gateways and APIs. Shows all request details: timestamp, API, method, path, status, latency, client IP. Use the panel's built-in search and filters to investigate specific requests, APIs, or gateways. Use for detailed troubleshooting and audit trails.",
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 97
      },
      "datasource": "${datasource_opensearch}",
      "targets": [
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\"",
          "refId": "A",
          "metrics": [
            {
              "type": "logs",
              "id": "1"
            }
          ],
          "bucketAggs": [],
          "timeField": "observedTimestamp"
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": false,
        "showCommonLabels": false,
        "wrapLogMessage": false,
        "prettifyLogMessage": false,
        "enableLogDetails": true,
        "dedupStrategy": "none",
        "sortOrder": "Descending"
      }
    },
    {
      "id": 25,
      "type": "table",
      "title": "Error Logs (4xx/5xx)",
      "description": "Recent error logs for all gateways and APIs, filtered by HTTP status codes 4xx (client errors) and 5xx (server errors). Use the table's search and filters to narrow down to specific APIs or gateways. Review error messages and patterns to identify root causes. Common issues: authentication failures, rate limits, upstream timeouts.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 107
      },
      "datasource": "${datasource_opensearch}",
      "targets": [
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\" AND attributes.tyk.status:(4* OR 5*)",
          "refId": "A",
          "metrics": [
            {
              "type": "logs",
              "id": "1"
            }
          ],
          "bucketAggs": [],
          "timeField": "observedTimestamp"
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "@timestamp": true,
              "_id": true,
              "_index": true,
              "_source": true,
              "_type": true,
              "attributes.attrs.tag": true,
              "attributes.data_stream.dataset": true,
              "attributes.data_stream.namespace": true,
              "attributes.data_stream.type": true,
              "attributes.log.file.path": true,
              "attributes.log.iostream": true,
              "attributes.tyk.prefix": true,
              "body": true,
              "instrumentationScope": true,
              "resource.service.name": true,
              "resource.service.namespace": true,
              "severity": true,
              "severity.number": true,
              "severity.text": true
            },
            "includeByName": {},
            "indexByName": {
              "@timestamp": 3,
              "_id": 4,
              "_index": 5,
              "_source": 6,
              "_type": 7,
              "attributes.attrs.tag": 8,
              "attributes.data_stream.dataset": 9,
              "attributes.data_stream.namespace": 10,
              "attributes.data_stream.type": 11,
              "attributes.log.file.path": 12,
              "attributes.log.iostream": 13,
              "attributes.tyk.api_id": 14,
              "attributes.tyk.api_key": 15,
              "attributes.tyk.api_name": 16,
              "attributes.tyk.client_ip": 17,
              "attributes.tyk.host": 18,
              "attributes.tyk.latency_gateway": 20,
              "attributes.tyk.latency_total": 19,
              "attributes.tyk.level": 1,
              "attributes.tyk.method": 21,
              "attributes.tyk.org_id": 22,
              "attributes.tyk.path": 23,
              "attributes.tyk.prefix": 24,
              "attributes.tyk.protocol": 25,
              "attributes.tyk.remote_addr": 26,
              "attributes.tyk.status": 27,
              "attributes.tyk.time": 28,
              "attributes.tyk.type": 29,
              "attributes.tyk.upstream_addr": 30,
              "attributes.tyk.upstream_latency": 31,
              "attributes.tyk.user_agent": 32,
              "body": 2,
              "instrumentationScope": 33,
              "observedTimestamp": 0,
              "resource.deployment.environment": 34,
              "resource.host.name": 35,
              "resource.os.type": 36,
              "resource.service.name": 37,
              "resource.service.namespace": 38,
              "severity.number": 39,
              "severity.text": 40
            },
            "renameByName": {
              "attributes.tyk.api_id": "API ID",
              "attributes.tyk.api_key": "API Key (Hashed)",
              "attributes.tyk.api_name": "API",
              "attributes.tyk.client_ip": "Client IP",
              "attributes.tyk.host": "",
              "attributes.tyk.latency_gateway": "Latency (Gateway)",
              "attributes.tyk.latency_total": "Latency",
              "attributes.tyk.level": "Log Level",
              "attributes.tyk.method": "Method",
              "attributes.tyk.path": "Path",
              "attributes.tyk.prefix": "",
              "attributes.tyk.status": "Status",
              "body": "Log Message",
              "observedTimestamp": "Time",
              "severity.number": ""
            }
          }
        },
        {
          "id": "sortBy",
          "options": {
            "sort": [
              {
                "desc": true,
                "field": "Time"
              }
            ]
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Time",
            "desc": true
          }
        ]
      },
      "fieldConfig": {
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Status"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "mappings",
                "value": [
                  {
                    "type": "range",
                    "options": {
                      "from": 400,
                      "to": 499,
                      "result": {
                        "color": "yellow"
                      }
                    }
                  },
                  {
                    "type": "range",
                    "options": {
                      "from": 500,
                      "to": 599,
                      "result": {
                        "color": "red"
                      }
                    }
                  }
                ]
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Latency"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "unit",
                "value": "dateTimeFromNow"
              }
            ]
          }
        ]
      }
    },
    {
      "id": 26,
      "type": "table",
      "title": "Slow Request Logs (>1000ms)",
      "description": "Requests exceeding 1 second total latency for all gateways and APIs. Use the table's search and filters to narrow down to specific APIs or gateways. Compare Total Latency vs Upstream Latency to determine if slowness is in gateway processing or backend services. High gateway latency indicates middleware bottlenecks.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 107
      },
      "datasource": "${datasource_opensearch}",
      "targets": [
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\" AND attributes.tyk.latency_total:>1000",
          "refId": "A",
          "metrics": [
            {
              "type": "logs",
              "id": "1"
            }
          ],
          "bucketAggs": [],
          "timeField": "observedTimestamp"
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "resource.service.name": true,
              "severity": true,
              "_id": true,
              "_index": true
            },
            "renameByName": {
              "observedTimestamp": "Time",
              "attributes.tyk.api_name": "API",
              "attributes.tyk.path": "Path",
              "attributes.tyk.method": "Method",
              "attributes.tyk.status": "Status",
              "attributes.tyk.latency_total": "Total Latency",
              "attributes.tyk.upstream_latency": "Upstream Latency",
              "attributes.tyk.client_ip": "Client IP"
            }
          }
        },
        {
          "id": "sortBy",
          "options": {
            "sort": [
              {
                "field": "Total Latency",
                "desc": true
              }
            ]
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Total Latency",
            "desc": true
          }
        ]
      },
      "fieldConfig": {
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Total Latency"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              },
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 1000,
                      "color": "yellow"
                    },
                    {
                      "value": 3000,
                      "color": "orange"
                    },
                    {
                      "value": 5000,
                      "color": "red"
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Upstream Latency"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "unit",
                "value": "dateTimeFromNow"
              }
            ]
          }
        ]
      }
    },
    {
      "id": 27,
      "type": "timeseries",
      "title": "Latency Breakdown: Gateway vs Upstream Processing Time",
      "description": "Average latency breakdown from access logs: Total (end-to-end), Upstream (backend), and Gateway (calculated as Total - Upstream). Use to identify whether performance issues originate from gateway or upstream services.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 115
      },
      "datasource": "${datasource_opensearch}",
      "targets": [
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\"",
          "refId": "A",
          "alias": "Total Latency",
          "metrics": [
            {
              "type": "avg",
              "field": "attributes.tyk.latency_total",
              "id": "1"
            }
          ],
          "bucketAggs": [
            {
              "type": "date_histogram",
              "field": "observedTimestamp",
              "id": "2",
              "settings": {
                "interval": "auto",
                "min_doc_count": 0,
                "trimEdges": 0
              }
            }
          ],
          "timeField": "observedTimestamp"
        },
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\"",
          "refId": "B",
          "alias": "Upstream Latency",
          "metrics": [
            {
              "type": "avg",
              "field": "attributes.tyk.upstream_latency",
              "id": "1"
            }
          ],
          "bucketAggs": [
            {
              "type": "date_histogram",
              "field": "observedTimestamp",
              "id": "2",
              "settings": {
                "interval": "auto",
                "min_doc_count": 0,
                "trimEdges": 0
              }
            }
          ],
          "timeField": "observedTimestamp"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true,
          "calcs": [
            "lastNotNull",
            "max",
            "mean"
          ]
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 10,
            "showPoints": "never",
            "spanNulls": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Total Latency"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Upstream Latency"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "purple",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Gateway Latency"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "transformations": [
        {
          "id": "calculateField",
          "options": {
            "mode": "binary",
            "binary": {
              "left": "Total Latency",
              "operator": "-",
              "right": "Upstream Latency"
            },
            "replaceFields": false,
            "alias": "Gateway Latency"
          }
        }
      ]
    },
    {
      "id": 28,
      "type": "table",
      "title": "Top Client IPs by Traffic (from Logs)",
      "description": "Most active client IP addresses ranked by request volume and average latency. Use to identify heavy users, detect bot traffic, or investigate suspicious activity. High request rates from single IPs may indicate abuse.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 115
      },
      "datasource": "${datasource_opensearch}",
      "targets": [
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\"",
          "refId": "A",
          "metrics": [
            {
              "type": "count",
              "id": "1"
            },
            {
              "type": "avg",
              "field": "attributes.tyk.latency_total",
              "id": "2"
            }
          ],
          "bucketAggs": [
            {
              "field": "attributes.tyk.client_ip.keyword",
              "id": "3",
              "settings": {
                "order": "desc",
                "orderBy": "_count",
                "size": "20"
              },
              "type": "terms"
            }
          ],
          "timeField": "observedTimestamp"
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "renameByName": {
              "attributes.tyk.client_ip.keyword": "Client IP",
              "Count": "Requests",
              "Average attributes.tyk.latency_total": "Avg Latency (ms)"
            }
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Requests",
            "desc": true
          }
        ]
      },
      "fieldConfig": {
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Avg Latency (ms)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              },
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 500,
                      "color": "yellow"
                    },
                    {
                      "value": 2000,
                      "color": "red"
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Requests"
            },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "lcd-gauge"
              },
              {
                "id": "custom.width",
                "value": 180
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 1000,
                      "color": "yellow"
                    },
                    {
                      "value": 10000,
                      "color": "orange"
                    },
                    {
                      "value": 50000,
                      "color": "red"
                    }
                  ]
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": 29,
      "type": "barchart",
      "title": "User Agent Distribution (from Logs)",
      "description": "Breakdown of traffic by user agent (browser, mobile app, API client). Use to understand client distribution and detect unusual traffic patterns. Unknown/bot user agents may indicate automated abuse.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 123
      },
      "datasource": "${datasource_opensearch}",
      "targets": [
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\"",
          "refId": "A",
          "metrics": [
            {
              "type": "count",
              "id": "1"
            }
          ],
          "bucketAggs": [
            {
              "type": "terms",
              "field": "attributes.tyk.user_agent.keyword",
              "id": "2",
              "settings": {
                "size": "10",
                "order": "desc",
                "orderBy": "_count"
              }
            }
          ],
          "timeField": "observedTimestamp"
        }
      ],
      "options": {
        "orientation": "horizontal",
        "xField": "attributes.tyk.user_agent.keyword",
        "showValue": "always",
        "legend": {
          "displayMode": "hidden"
        }
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        }
      }
    },
    {
      "id": 30,
      "type": "table",
      "title": "Upstream Service Health (from Logs)",
      "description": "Health metrics for backend upstream services: total requests, average latency, error count, and error rate. Use to identify problematic backend services. High error rates or latencies indicate upstream service issues requiring investigation.",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 123
      },
      "datasource": "${datasource_opensearch}",
      "targets": [
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\"",
          "refId": "A",
          "metrics": [
            {
              "type": "count",
              "id": "1"
            },
            {
              "type": "avg",
              "field": "attributes.tyk.upstream_latency",
              "id": "2"
            }
          ],
          "bucketAggs": [
            {
              "type": "terms",
              "field": "attributes.tyk.upstream_addr.keyword",
              "id": "3",
              "settings": {
                "size": "50",
                "order": "desc",
                "orderBy": "_count"
              }
            }
          ],
          "timeField": "observedTimestamp"
        },
        {
          "query": "resource.service.name:\"tyk-gateway\" AND attributes.tyk.prefix:\"access-log\" AND attributes.tyk.status:5*",
          "refId": "B",
          "metrics": [
            {
              "type": "count",
              "id": "1"
            }
          ],
          "bucketAggs": [
            {
              "type": "terms",
              "field": "attributes.tyk.upstream_addr.keyword",
              "id": "2",
              "settings": {
                "size": "50",
                "order": "desc",
                "orderBy": "_count"
              }
            }
          ],
          "timeField": "observedTimestamp"
        }
      ],
      "transformations": [
        {
          "id": "merge",
          "options": {}
        },
        {
          "id": "organize",
          "options": {
            "renameByName": {
              "attributes.tyk.upstream_addr.keyword": "Upstream Service",
              "Count #A": "Total Requests",
              "Average attributes.tyk.upstream_latency": "Avg Latency (ms)",
              "Count #B": "Errors"
            }
          }
        },
        {
          "id": "calculateField",
          "options": {
            "mode": "binary",
            "binary": {
              "left": "Errors",
              "operator": "/",
              "right": "Total Requests"
            },
            "replaceFields": false,
            "alias": "Error Rate"
          }
        },
        {
          "id": "calculateField",
          "options": {
            "mode": "binary",
            "binary": {
              "left": "Error Rate",
              "operator": "*",
              "right": "100"
            },
            "replaceFields": false,
            "alias": "Error %"
          }
        }
      ],
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "displayName": "Total Requests",
            "desc": true
          }
        ]
      },
      "fieldConfig": {
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Error %"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.displayMode",
                "value": "color-background"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "value": null,
                      "color": "green"
                    },
                    {
                      "value": 1,
                      "color": "yellow"
                    },
                    {
                      "value": 5,
                      "color": "red"
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Avg Latency (ms)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "ms"
              },
              {
                "id": "decimals",
                "value": 0
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Error Rate"
            },
            "properties": [
              {
                "id": "custom.hidden",
                "value": true
              }
            ]
          }
        ]
      }
    }
  ],
  "schemaVersion": 38,
  "style": "dark",
  "fiscalYearStartMonth": 0
}