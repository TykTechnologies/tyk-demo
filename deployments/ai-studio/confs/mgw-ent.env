# Edge Microgateway Configuration
# Connects to control plane running at localhost:8080

# ============================================================================
# Server Configuration
# ============================================================================
PORT=9091
HOST=0.0.0.0
TLS_ENABLED=false
READ_TIMEOUT=300s
WRITE_TIMEOUT=300s
IDLE_TIMEOUT=120s
SHUTDOWN_TIMEOUT=30s

# ============================================================================
# Database Configuration - Edge uses SQLite for local caching
# ============================================================================
DATABASE_TYPE=sqlite
DATABASE_DSN=file:/app/data/edge.db?cache=shared&mode=rwc

DB_MAX_OPEN_CONNS=25
DB_MAX_IDLE_CONNS=25
DB_CONN_MAX_LIFETIME=5m
DB_AUTO_MIGRATE=true
DB_LOG_LEVEL=warn

# ============================================================================
# Cache Configuration
# ============================================================================
CACHE_ENABLED=true
CACHE_MAX_SIZE=1000
CACHE_TTL=1h
CACHE_CLEANUP_INTERVAL=10m
CACHE_PERSIST_TO_DB=false

# ============================================================================
# Gateway Configuration
# ============================================================================
GATEWAY_TIMEOUT=30s
GATEWAY_MAX_REQUEST_SIZE=10485760
GATEWAY_MAX_RESPONSE_SIZE=52428800
GATEWAY_DEFAULT_RATE_LIMIT=100
GATEWAY_ENABLE_FILTERS=true
GATEWAY_ENABLE_ANALYTICS=true

# ============================================================================
# Analytics Configuration
# ============================================================================
ANALYTICS_ENABLED=true
ANALYTICS_BUFFER_SIZE=1000
ANALYTICS_FLUSH_INTERVAL=10s
ANALYTICS_RETENTION_DAYS=90
ANALYTICS_REALTIME=false
ANALYTICS_STORE_REQUESTS=false
ANALYTICS_STORE_RESPONSES=false
ANALYTICS_MAX_BODY_SIZE=4096

# ============================================================================
# Security Configuration - Must match control plane
# ============================================================================
JWT_SECRET=a35b3f7b0fb4dd3a048ba4fc6e9fe0a8cb804d7884c62b6b2ea09c99612c4406
ENCRYPTION_KEY=822d3d1e0e2d849263e45fc7bb842364
BCRYPT_COST=10
TOKEN_LENGTH=32
SESSION_TIMEOUT=24h
ENABLE_RATE_LIMITING=true
ENABLE_IP_WHITELIST=false

# ============================================================================
# Observability Configuration
# ============================================================================
LOG_LEVEL=info
LOG_FORMAT=text
ENABLE_METRICS=false
METRICS_PATH=/metrics
ENABLE_TRACING=false
TRACING_ENDPOINT=http://localhost:14268/api/traces
ENABLE_PROFILING=false

# ============================================================================
# Hub-and-Spoke Configuration - EDGE MODE
# ============================================================================
GATEWAY_MODE=edge

# Edge Instance Configuration
CONTROL_ENDPOINT=midsommar:9080
EDGE_ID=edge-01
EDGE_NAMESPACE=default
EDGE_RECONNECT_INTERVAL=5s
EDGE_HEARTBEAT_INTERVAL=30s
EDGE_SYNC_TIMEOUT=10s

# Edge Authentication - REQUIRED for edge mode
EDGE_AUTH_TOKEN=822d3d1e0e2d849263e45fc7bb842364

# Edge TLS Configuration (development - insecure)
EDGE_TLS_ENABLED=false
EDGE_SKIP_TLS_VERIFY=false
EDGE_ALLOW_INSECURE=true

# Token Validation Cache
EDGE_TOKEN_CACHE_ENABLED=true
EDGE_TOKEN_CACHE_TTL=5m
EDGE_TOKEN_CACHE_MAX_SIZE=1000
EDGE_TOKEN_CACHE_CLEANUP_INTERVAL=1m

# ============================================================================
# Development Settings
# ============================================================================
ALLOW_INTERNAL_NETWORK_ACCESS=true

# ============================================================================
# OCI Plugin Configuration
# ============================================================================
OCI_PLUGINS_CACHE_DIR=/data/cache/plugins
OCI_PLUGINS_MAX_CACHE_SIZE=1073741824
OCI_PLUGINS_REQUIRE_SIGNATURE=true
OCI_PLUGINS_ALLOWED_REGISTRIES=localhost:5101,docker.tyk.io
OCI_PLUGINS_TIMEOUT=30s
OCI_PLUGINS_RETRY_ATTEMPTS=3
OCI_PLUGINS_GC_INTERVAL=24h
OCI_PLUGINS_KEEP_VERSIONS=3
OCI_PLUGINS_INSECURE_REGISTRIES=localhost:5101
OCI_PLUGINS_PUBKEY_FILE_LIVE=./keys/plugins/plugin-live.pub
OCI_PLUGINS_REQUIRE_SIGNATURE=true

# ============================================================================
# Plugin Configuration
# ============================================================================
# Analytics plugin for sending data to control plane
PLUGINS_CONFIG_PATH=./mgw-analytics.yaml

# Alternative: Service-based configuration
# PLUGINS_CONFIG_SERVICE_URL=
# PLUGINS_CONFIG_SERVICE_TOKEN=
# PLUGINS_CONFIG_POLL_INTERVAL=30s
MICROGATEWAY_ALLOW_ALL_PLUGIN_PATHS=1